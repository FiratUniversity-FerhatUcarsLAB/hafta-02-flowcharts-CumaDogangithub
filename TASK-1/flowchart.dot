digraph ATM {
  rankdir=TB;
  node [shape=box, fontname="Arial", fontsize=11];

  start   [shape=circle, label="Başla"];
  init    [label="ATM nakit durumunu ve sayaçları hazırla"];
  insert  [label="Kart takıldı / Kartı oku"];
  cardOk  [shape=diamond, label="Kart okunabildi mi?"];
  reject  [label="Kartı iade et\nMesaj: Kart okunamadı"];
  end     [shape=doublecircle, label="Bitiş"];

  pin     [label="PIN iste"];
  pinOk   [shape=diamond, label="PIN doğru mu?"];
  incTry  [label="Deneme sayısını artır"];
  tryLeft [shape=diamond, label="Deneme < 3 mü?"];
  keep    [label="Kartı alıkoy\nMesaj: 3 hatalı PIN"];
  session [label="Oturumu aç"];

  menu    [label="MENÜ:\n1 Çekme | 2 Yatırma | 3 Bakiye\n4 Havale/EFT | 5 Şifre Değiştir | 0 Çıkış"];
  choice  [shape=diamond, label="Seçim?"];

  /* İşlemler */
  wd      [label="Para Çekme\nTutar iste"];
  wdOk    [shape=diamond, label="Tutar geçerli,\n10 TL katı,\nBakiye & ATM nakit yeterli,\nGünlük limit uygun mu?"];
  wdFail  [label="Mesaj: Koşullar sağlanmıyor"];
  wdDo    [label="Hesaptan düş\nATM para ver"];
  
  dep     [label="Para Yatırma\n(Nakit/Zarf)"];
  depOk   [shape=diamond, label="Tutar geçerli mi?"];
  depFail [label="Mesaj: Geçersiz tutar"];
  depDo   [label="Hesaba ekle\n(geçici/teyitli)"];

  bal     [label="Bakiye Sorgu\nBakiyeyi göster"];

  tr      [label="Havale/EFT\nIBAN + Tutar iste"];
  trOk    [shape=diamond, label="IBAN geçerli,\nBakiye masrafla yeterli mi?"];
  trFail  [label="Mesaj: IBAN/Bakiye hatası"];
  trDo    [label="Hesaptan düş\nTransfer gönder"];

  pinchg  [label="Şifre Değiştir\nEski PIN + Yeni PIN iste"];
  pcOk    [shape=diamond, label="Eski PIN doğru ve\nyeni PIN kurala uygun mu?"];
  pcFail  [label="Mesaj: PIN hatası/kuralsız"];
  pcDo    [label="PIN güncelle"];

  exitReq [label="Kartı iade et\nMesaj: İyi günler"];
  againQ  [shape=diamond, label="Başka işlem?"];
  
  /* Akış */
  start -> init -> insert -> cardOk;
  cardOk -> reject [label="Hayır"];
  reject -> end;
  cardOk -> pin [label="Evet"];

  pin -> pinOk;
  pinOk -> session [label="Evet"];
  pinOk -> incTry  [label="Hayır"];
  incTry -> tryLeft;
  tryLeft -> pin   [label="Evet"];
  tryLeft -> keep  [label="Hayır"];
  keep -> end;

  session -> menu -> choice;

  /* Seçimler */
  choice -> wd     [label="1"];
  choice -> dep    [label="2"];
  choice -> bal    [label="3"];
  choice -> tr     [label="4"];
  choice -> pinchg [label="5"];
  choice -> exitReq[label="0"];
  choice -> menu   [label="Diğer"];

  /* Para Çekme */
  wd -> wdOk;
  wdOk -> wdDo   [label="Evet"];
  wdOk -> wdFail [label="Hayır"];
  wdFail -> againQ;
  wdDo -> againQ;

  /* Para Yatırma */
  dep -> depOk;
  depOk -> depDo   [label="Evet"];
  depOk -> depFail [label="Hayır"];
  depFail -> againQ;
  depDo -> againQ;

  /* Bakiye */
  bal -> againQ;

  /* Transfer */
  tr -> trOk;
  trOk -> trDo   [label="Evet"];
  trOk -> trFail [label="Hayır"];
  trFail -> againQ;
  trDo -> againQ;

  /* PIN Değiştir */
  pinchg -> pcOk;
  pcOk -> pcDo   [label="Evet"];
  pcOk -> pcFail [label="Hayır"];
  pcFail -> againQ;
  pcDo -> againQ;

  /* Döngü & Çıkış */
  againQ -> menu   [label="Evet"];
  againQ -> exitReq[label="Hayır"];
  exitReq -> end;
}
